+++
title = "Безопасные кросс-доменные ссылки"
date = "2020-06-12T03:11:11+03:00"
tags = ["security", "frontend", "backend", "безопасность"]
+++

Немного про не очень очевидную безопасность, в основном касающуюся фронтенда. Мой соц опрос показал, что очень малое
количество фронтов, да и бэкендеров, про нее знают. Рассмотрим на примере:

```html
<a href="https://some-domain.com" target="_blank">Ссылка</a>
```

Казалось бы, что может пойти не так и при чем тут безопасность?

Любые страницы, открытые в новом окне, имеют доступ к окну вкладки, которая их открыла через `window.opener`. Это
означает, что сайт, открытый в новой вкладке, может изменить предыдущую вкладку практически как угодно, начиная от
редиректа и заканчивая перерисовкой или внедрением стороннего `javascript`'а так, что вы этого даже не поймете. Обычный
кейс - показать форму логина с надписью типа **Ваша сессия истекла, введите логин и пароль для продления** и отправить
данные на сторонний подконтрольный сервер.

В общем случае, лечить это достаточно просто:

```html
<a href="https://some-domain.com" target="_blank" rel="noopener">Ссылка</a>

<!--или-->

<a href="https://some-domain.com" target="_blank" rel="noreferrer">Ссылка</a>
```

Последнее дополнительно запретит передачу заголовка `Referer`. Но, к сожалению, корпоративщики до сих пор используют
ИЕ 11, где [нет поддержки noopener](https://caniuse.com/#search=noopener),
а [поддержка noreferrer ограничена определенной версией windows](https://caniuse.com/#search=noreferrer). Чтобы
предусмотреть все кейсы, можно сделать, к примеру, как ВКонтакте, который превращает все внешние ссылки в
`https://vk.com/away.php?to=https://`, т.е. в новом окне открывается домен `vk.com`, а потом редирект перебрасывает вас
на другой домен, но уже в этом же окне.

Речь не только о ссылках, которые приходят из-вне, речь о любых кросс-доменных ссылках. В случае компрометации сторонних
доменов, появляется возможность влиять на ваш сайт.

Пруфы и демки можно посмотреть [тут](https://mathiasbynens.github.io/rel-noopener/).