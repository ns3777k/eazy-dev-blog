+++
title = "–°–æ–∑–¥–∞–Ω–∏–µ API –Ω–∞ –±–∞–∑–µ Symfony 5. –ß–∞—Å—Ç—å 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π"
date = "2021-05-03T13:30:50+03:00"
tags = ["php", "backend", "symfony", "api"]
+++

[–°–æ–∑–¥–∞–Ω–∏–µ API –Ω–∞ –±–∞–∑–µ Symfony 5. –ß–∞—Å—Ç—å 1. –í–≤–µ–¥–µ–Ω–∏–µ]({{< relref "symfony-api-1" >}})

[–°–æ–∑–¥–∞–Ω–∏–µ API –Ω–∞ –±–∞–∑–µ Symfony 5. –ß–∞—Å—Ç—å 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è]({{< relref "symfony-api-2" >}})

[–°–æ–∑–¥–∞–Ω–∏–µ API –Ω–∞ –±–∞–∑–µ Symfony 5. –ß–∞—Å—Ç—å 3. –ù–∞—á–∞–ª–æ –ø—Ä–æ–µ–∫—Ç–∞]({{< relref "symfony-api-3" >}})

## –¢–æ–≥–¥–∞

–í –ø—Ä–æ—à–ª–æ–π —Å—Ç–∞—Ç—å–µ –º—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–∞—à –ø–µ—Ä–≤—ã–π –ø—Ä–æ—Å—Ç–µ–π—à–∏–π —Ä–æ—É—Ç –∏ –≤—ã—É—á–∏–ª–∏ –æ–¥–Ω–æ –∏–∑ —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª - –ª—é–±–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö. –î–∞–∂–µ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è. –ü–æ —Å—É—Ç–∏, –≤–µ—Å—å –∫–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø–∏—à–µ—Ç–µ, –¥–æ–ª–∂–µ–Ω —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö üôÇ
–ö–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–∏—Å—É, –≤—ã *–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ* –¥–æ –Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø. –ö –ø—Ä–∏–º–µ—Ä—É, —á—Ç–æ–±—ã –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –Ω–µ–º—É —á–µ—Ä–µ–∑
**HTTP** –≤—ã –ø–∏—à–µ—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, —á—Ç–æ–±—ã –≤—ã–∑–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ rabbitmq - –≤—ã –ø–∏—à–∏—Ç–µ –≤–æ—Ä–∫–µ—Ä–∞ –∏ —Ç.–ø.

## –°–µ–π—á–∞—Å

–í —ç—Ç–æ–π —á–∞—Å—Ç–∏ –º—ã —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º—Å—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –∏ –¥–ª—è —ç—Ç–æ–≥–æ –º—ã –¥–æ–±–∞–≤–∏–º –µ—â–µ –ø–∞—Ä—É –º–µ—Ç–æ–¥–æ–≤ –≤ –Ω–∞—à–µ API:
**–ø–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ –ø–æ id** –∏ **–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–Ω–∏–≥ –ø–æ id –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**.

–ö–æ–≥–¥–∞ –º—ã –≤—ã–∑—ã–≤–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã, –æ–Ω–∏ –º–æ–≥—É—Ç –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –∏—Ö –Ω—É–∂–Ω–æ –∫–∞–∫–∏–º-—Ç–æ –æ–±—Ä–∞–∑–æ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –æ—Ç–¥–∞–≤–∞—Ç—å
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö. –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –ø–∏—à–µ–º API —Å json-—Ñ–æ—Ä–º–∞—Ç–æ–º, —Ç–æ –æ—à–∏–±–∫–∏ —Ç–∞–∫ –∂–µ –¥–æ–ª–∂–Ω—ã
–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å—Å—è –≤ json-–æ—Ç–≤–µ—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º http-–∫–æ–¥–æ–º. –î–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–π–º–µ–º—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –∞ –ø–æ—Ç–æ–º
—Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏–π.

## –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–∏–≥–∏

–ú—ã –Ω–µ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å –ø—Ä—è–º —Ä–µ–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –∫–Ω–∏–≥–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ —ç—Ç–æ–º –Ω–µ –±—É–¥–µ—Ç —Å–º—ã—Å–ª–∞ –¥–ª—è –Ω–∞—à–∏—Ö —Ü–µ–ª–µ–π. –ò—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É
`./bin/console make:entity Book` —Å–æ–∑–¥–∞–¥–∏–º —Å–ª–µ–¥—É—é—â—É—é —Å—É—â–Ω–æ—Å—Ç—å:

```php
<?php

/**
 * @ORM\Entity(repositoryClass=BookRepository::class)
 */
class Book
{
    /**
     * @ORM\Id
     * @ORM\GeneratedValue(strategy="IDENTITY")
     * @ORM\Column(type="integer")
     */
    private ?int $id;

    /**
     * @ORM\Column(type="string", length=255)
     */
    private string $title;

    /**
     * @ORM\ManyToOne(targetEntity="App\Entity\Category")
     */
    private Category $category;

    /**
     * @ORM\Column(type="date", name="published_date")
     */
    private DateTimeInterface $publishedDate;

    /**
     * @ORM\Column(type="string", length=255)
     */
    private string $author;

    /**
     * @ORM\Column(type="boolean", name="is_bestseller")
     */
    private bool $isBestseller;

    /**
     * @ORM\Column(type="decimal", precision=5, scale=2)
     */
    private float $price;

    /**
     * @ORM\Column(type="string", length=255)
     */
    private string $isbn;
}
```

–ó–¥–µ—Å—å –∏ –¥–∞–ª–µ–µ —è –ø—Ä–∏–≤–æ–∂—É —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞, –ø–æ–ª–Ω—ã–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ github –ø–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ç—ç–≥–æ–º.

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–∏, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á—Ç–æ? –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –Ω–∞–ø–∏—Å–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç—Ç–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é üôÇ –°–æ–∑–¥–∞–µ–º
`BookService`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ä–∞–Ω–µ–µ –æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

```php
<?php

class BookService
{
    private BookRepository $bookRepository;

    private CategoryRepository $categoryRepository;

    private function mapBook(BookEntity $entity): Book
    {
        return (new Book())
            ->setId((int) $entity->getId())
            ->setTitle($entity->getTitle())
            ->setAuthor($entity->getAuthor())
            ->setIsBestseller($entity->isBestseller())
            ->setPrice($entity->getPrice())
            ->setIsbn($entity->getIsbn())
            ->setPublishedDate($entity->getPublishedDate());
    }

    public function getById(int $id): Book
    {
        $book = $this->bookRepository->find($id);
        if (null === $book) {
            throw new BookNotFoundException();
        }

        return $this->mapBook($book);
    }

    /**
     * @return Book[]
     * @psalm-return array<Book>
     */
    public function getByCategoryId(int $id): array
    {
        $category = $this->categoryRepository->find($id);
        if (null === $category) {
            throw new CategoryNotFoundException();
        }

        return array_map(
            [$this, 'mapBook'],
            $this->bookRepository->findBy(['category' => $category])
        );
    }
}
```

–°–µ—Ä–≤–∏—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ–π, –ø–æ—ç—Ç–æ–º—É –Ω–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –Ω–∏ –º–æ–¥–µ–ª–∏ —è –ø—Ä–∏–≤–æ–¥–∏—Ç—å —è –Ω–µ –±—É–¥—É. –ü–æ—Ä–∞ –∑–∞–Ω—è—Ç—å—Å—è –¥–µ–ª–æ–º üôÇ

## –ü–µ—Ä–≤—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

–ò—Å—Ö–æ–¥—è –∏–∑ –∫–æ–¥—ã –≤—ã—à–µ, –µ—Å–ª–∏ –º—ã –Ω–µ –Ω–∞—à–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ –∫–Ω–∏–≥—É –º—ã –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –Ω–æ –∫–∞–∫ –æ–Ω–æ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ? –ï—Å–ª–∏
–º—ã –Ω–µ —É–∫–∞–∑—ã–≤–∞–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Accept` –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ, —Ç–æ –º—ã —É–≤–∏–¥–∏–º –≤ –æ—Ç–≤–µ—Ç **html —Å –æ—à–∏–±–∫–æ–π**. –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞ –±—É–¥–µ—Ç **500**.
–ù–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ? –°–æ–≤—Å–µ–º –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ. **500 –æ—à–∏–±–∫–∞** –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –æ—à–∏–±–∫—É —Å–µ—Ä–≤–µ—Ä–∞, –Ω–æ —É –Ω–∞—Å –Ω–µ –±—ã–ª–æ
–Ω–∏–∫–∞–∫–æ–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏. –ú—ã –ø—Ä–æ—Å—Ç–æ –Ω–µ –Ω–∞—à–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é / –∫–Ω–∏–≥—É –∏ –Ω–∞–º –±—ã –±–æ–ª—å—à–µ —Ö–æ—Ç–µ–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å **404** —Å –∫–∞–∫–∏–º-–Ω–∏–±—É–¥—å
–≤–º–µ–Ω—è–µ–º—ã–º —Ç–µ–∫—Å—Ç–æ–º. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?

–°–∞–º–æ–µ –Ω–∞–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –±—ã–ª–æ –±—ã —Ç–∞–∫–∏–º:

```php
<?php

class BookController extends AbstractController
{
    private BookService $bookService;
    
    /**
     * @Route("/api/v1/book/{id}", name="book", methods={"GET"})
     */
    public function book(int $id): Response
    {
        try {
            $books = $this->json($bookService->getById($id));
        } catch (BookNotFoundException $notFoundException) {
            throw new NotFoundHttpException('book not found', $exception);
        }
        
        return $this->json($books);
    }
}
```

–¢.–µ. –≤ –∫–∞–∂–¥–æ–º –º–µ—Ç–æ–¥–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞, –ª–æ–≤–∏—Ç—å –¥–æ–º–µ–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –∏—Ö –≤
http-–∏—Å–∫–ª—é—á–µ–Ω–∏—è. –í—Ä–æ–¥–µ –¥–∞–∂–µ –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ —Ç–∞–∫ –ø–ª–æ—Ö–æ üôÇ –ù–æ, —á—Ç–æ –±—É–¥–µ—Ç –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å —Å–º–æ–∂–µ—Ç –≤—ã–∫–∏–¥—ã–≤–∞—Ç—å –Ω–µ 1 –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∞ 3?
–¢–æ–≥–¥–∞ –≤ –∫–∞–∂–¥–æ–º –º–µ—Ç–æ–¥–µ, –≥–¥–µ —è–≤–Ω–æ –∏–ª–∏ –Ω–µ —è–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å–µ—Ä–≤–∏—Å–∞, –º—ã –±—É–¥–µ–º –≤—ã–Ω—É–∂–¥–µ–Ω—ã –ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–∂–¥–æ–≥–æ
–∏–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π. –ü–ª—é—Å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫ –µ—Å–ª–∏ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Å–∞–º–æ–º —Å–µ—Ä–≤–∏—Å–µ. –ê –µ—Å–ª–∏ —É –Ω–∞—Å –ø–∞—á–∫–∞ –º–µ—Ç–æ–¥–æ–≤,
—Ç–æ —Ç–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –±—ã—Å—Ç—Ä–æ –∑–∞—Å—Ç–∞–≤–∏—Ç –Ω–∞—à–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Ç–æ–ª—Å—Ç–µ—Ç—å. 

–ê –ø–æ—á–µ–º—É –±—ã –Ω–µ –≤—ã–∫–∏–¥—ã–≤–∞—Ç—å —Å—Ä–∞–∑—É –∏—Å–∫–ª—é—á–µ–Ω–∏—è —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç `HttpException` —Ç–∏–ø–∞ `NotFoundHttpException` –∏–∑ –ø–∞–∫–µ—Ç–∞
`http-kernel`? –û–Ω–∏ –∫–∞–∫ —Ä–∞–∑ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω—ã –≤–æ –≤–º–µ–Ω—è–µ–º—ã–π –æ—Ç–≤–µ—Ç. –û—Ç–≤–µ—Ç –ø—Ä–æ—Å—Ç–æ–π - –º—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –ø—É—Ç–∞—Ç—å
—Å–ª–æ–∏. –ö–æ–≥–¥–∞ –º—ã –ø–∏—à–µ–º –ª–æ–≥–∏–∫—É –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö, –º—ã –≤–æ–æ–±—â–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –ø–æ–Ω—è—Ç–∏—è –∫–∞–∫ —ç—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –±—ã–ª –≤—ã–∑–≤–∞–Ω. –ö –ø—Ä–∏–º–µ—Ä—É, —á—Ç–æ
–µ—Å–ª–∏ –Ω–∞—à —Å–µ—Ä–≤–∏—Å –±—ã–ª –≤—ã–∑–≤–∞–Ω –∏–∑ –∫—Ä–æ–Ω–∞? –í—ã–∫–∏–¥—ã–≤–∞—Ç—å –ø—Ä–∏ —ç—Ç–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ http - —á—Ç–æ-—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ –ø–æ—Ç–æ–º—É —á—Ç–æ
–Ω–∏–∫–∞–∫–æ–≥–æ –æ–±—â–µ–Ω–∏—è –ø–æ http –Ω–µ –±—ã–ª–æ üôÇ

## –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ API

–ë–æ–ª–µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ `—Å–ª–æ—è`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏
–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç—É –æ—à–∏–±–∫—É –≤ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–º –µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–µ. –ù–æ –∏–∑ —á–µ–≥–æ –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å —ç—Ç–æ—Ç —Å–ª–æ–π –∏ –≥–¥–µ –æ–Ω –±—É–¥–µ—Ç
—Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è? –°–ª–æ–π –±—É–¥–µ—Ç —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏ —Å–µ—Ä–≤–∏—Å–∞. –û–Ω –±—É–¥–µ—Ç –æ—Ç–ª–∞–≤–ª–∏–≤–∞—Ç—å –ª—é–±—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è,
–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ –ø–æ–π–º–∞–Ω—ã. –¢–µ–º —Å–∞–º—ã–º –º—ã —Å–æ—Ö—Ä–∞–Ω–∏–º —Å–µ—Ä–≤–∏—Å –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º, –∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Ç–æ–Ω–∫–∏–º.

–ß—Ç–æ–±—ã —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å, –º—ã –±—É–¥–µ–º –ª–æ–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏—è `KernelEvents::EXCEPTION` –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –º—ã —Å–º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ
–∏—Å–∫–ª—é—á–µ–Ω–∏–µ. –ß—Ç–æ–±—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –µ–≥–æ –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞—Ç—å –º–∞–ø–ø–∏–Ω–≥–∏ –∏ —Å–µ—Ä–≤–∏—Å –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –º–∞–ø–ø–∏–Ω–≥–∞
–ø–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—é.

–¢–µ—Ö–Ω–∏–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç–∞—Ä–∞—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ FosRestBundle –∏ API Platform.

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ–π. –î–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ–¥–µ–º –≤ `config/services.yaml` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```yaml
parameters:
    exceptions: 
        App\Exception\BookNotFoundException: { code: 404, hidden: false }
        App\Exception\CategoryNotFoundException: { code: 404, hidden: false }
```

–ú—ã –æ–≥—Ä–∞–Ω–∏—á–∏–º—Å—è 2–º—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏, –Ω–æ –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–º –±–æ–ª—å—à–µ. –ö–ª—é—á–æ–º —è–≤–ª—è–µ—Ç—Å—è FQCN, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ–º —Ö—ç—à –Ω–∞—Å—Ç—Ä–æ–µ–∫, –≥–¥–µ:

- `code` - –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞;
- `hidden` - —Å–∫—Ä—ã–≤–∞—Ç—å –ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —ç–∫—Å–µ–ø—à–µ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ç.–µ. –Ω–µ
–æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É);
- `loggable` - –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è).

–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ—Å—Ç–µ–π—à–∏–π –∫–ª–∞—Å—Å `ExceptionMapping` –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:

```php
<?php

class ExceptionMapping
{
    private int $code;

    private bool $hidden;

    private bool $loggable;

    public function __construct(int $code, bool $hidden = true, bool $loggable = false)
    {
        $this->code = $code;
        $this->hidden = $hidden;
        $this->loggable = $loggable;
    }
    
    // –≥–µ—Ç—Ç–µ—Ä—ã
```

–≠—Ç–æ—Ç –∫–ª–∞—Å—Å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Å–µ—Ä–≤–∏—Å–µ `ExceptionMappingResolver`:

```php
<?php

class ExceptionMappingResolver
{
    private array $mappings = [];

    private function addMapping(string $class, int $code, bool $hidden, bool $loggable): void
    {
        $this->mappings[$class] = new ExceptionMapping($code, $hidden, $loggable);
    }

    public function __construct(array $mappings)
    {
        foreach ($mappings as $class => $mapping) {
            if (empty($mapping['code'])) {
                throw new InvalidArgumentException('code is mandatory for class '.$class);
            }

            $this->addMapping(
                $class,
                $mapping['code'],
                $mapping['hidden'] ?? true,
                $mapping['loggable'] ?? false,
            );
        }
    }

    public function resolve(string $throwableClass): ?ExceptionMapping
    {
        $foundMapping = null;

        foreach ($this->mappings as $class => $mapping) {
            if ($throwableClass === $class || is_subclass_of($throwableClass, $class)) {
                $foundMapping = $mapping;
                break;
            }
        }

        return $foundMapping;
    }
}
```

–•–æ—Ç–µ–ª–æ—Å—å –±—ã –æ–±—Ä–∞—Ç–∏—Ç—å –≤–∞—à–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –º—ã –≤—ã–∫–∏–¥—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. –û–±—ã—á–Ω–æ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –Ω–µ –¥–æ–ª–∂–Ω–æ
–±—ã—Ç—å –Ω–∏–∫–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ –∫—Ä–æ–º–µ –∫–∞–∫ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –≤ –ø–æ–ª—è –∫–ª–∞—Å—Å–∞, –ø–æ—á–µ–º—É —Ç–æ–≥–¥–∞ –º—ã –∫–∏–¥–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥
`addMapping`, —Ö–æ—Ç—è –º–æ–≥–ª–∏ –±—ã —ç—Ç—É 1 —Å—Ç—Ä–æ—á–∫—É –Ω–∞–ø–∏—Å–∞—Ç—å —Å—Ä–∞–∑—É –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ?

–ü—Ä–∏—á–∏–Ω–∞ –≤—ã–±—Ä–∞—Å—ã–≤–∞–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤ **php** —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤. –¢.–µ. –º—ã –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ–º –æ
—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –º–∞—Å—Å–∏–≤–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –ø–µ—Ä–µ–¥–∞–ª–∏. –¢.–µ. —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –µ—Å–ª–∏ –Ω–∞–º –ø–µ—Ä–µ–¥–∞–ª–∏ –Ω–µ —Ç–æ—Ç —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –º—ã
–æ–∂–∏–¥–∞–µ–º, —Ç–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞ –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –≤–ø–æ–ª–Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ.

–ú–µ—Ç–æ–¥ `addMapping` –±—ã–ª —Å–æ–∑–¥–∞–Ω —Ç–æ–∂–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫. –û–Ω –Ω—É–∂–µ–Ω –ø–æ —Ç–æ–π –∂–µ –ø—Ä–∏—á–∏–Ω–µ - –≤—ã–Ω–æ—Å—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π
–º–µ—Ç–æ–¥, –º—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å—Ä–∞–∑—É –≤ —Å–ø–∏—Å–∫–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –¢–∞–∫–æ–π –ø—Ä–∏–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö
**Symfony**.

–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:

```yaml
App\Service\System\ExceptionMappingResolver:
    arguments: ['%exceptions%']
```

–°–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –Ω–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥ `resolve`, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ
–Ω–∞–∑–≤–∞–Ω–∏—é –∫–ª–∞—Å—Å—É –ª–∏–±–æ –ø–æ –µ–≥–æ –ø—Ä–µ–¥–∫—É. –ï—Å–ª–∏ –º–∞–ø–ø–∏–Ω–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `null`.

–û–∫–µ–π, –º—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —Ä–µ–∑–æ–ª–≤–µ—Ä, –Ω–æ —á—Ç–æ —Å –Ω–∏–º —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞—Ç—å? –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∏ –∑–∞—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å? –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –Ω—É–∂–Ω–æ
–Ω–∞–ø–∏—Å–∞—Ç—å –µ—â–µ 1 –∫–ª–∞—Å—Å - `ApiExceptionListener`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ª–æ–≤–∏—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å,
—á—Ç–æ–±—ã —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É:

```php
<?php

class ApiExceptionListener
{
    public function __invoke(ExceptionEvent $event): void
    {
        $throwable = $event->getThrowable();
        $mapping = $this->mappingResolver->resolve(\get_class($throwable));
        if (null === $mapping) {
            $mapping = new ExceptionMapping(Response::HTTP_INTERNAL_SERVER_ERROR);
        }

        if ($mapping->getCode() >= Response::HTTP_INTERNAL_SERVER_ERROR || $mapping->isLoggable()) {
            $this->logger->error($throwable->getMessage(), [
                'trace' => $throwable->getTraceAsString(),
                'previous' => null !== $throwable->getPrevious() ? $throwable->getPrevious()->getMessage() : '',
            ]);
        }

        $message = $mapping->isHidden() ? Response::$statusTexts[$mapping->getCode()] : $throwable->getMessage();
        $data = $this->serializer->serialize(new ErrorResponse($message), JsonEncoder::FORMAT);
        $response = new JsonResponse($data, $mapping->getCode(), [], true);
        $event->setResponse($response);
    }
}
```

–ú–Ω–æ–≥–æ –∫–æ–¥–∞, —á—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç? –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∑–∞–ø—Ä–µ—Ç–∞ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –ï—Å–ª–∏ –º—ã –Ω–µ
—É–∫–∞–∑–∞–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, —Ç–æ –æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç —Å –∫–æ–¥–æ–º 500 –∏ –ø—É—Å—Ç—ã–º —Ç–µ–ª–æ–º. –î–∞–ª–µ–µ, –º—ã –ª–æ–≥–∏—Ä—É–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –µ—Å–ª–∏ –∫–æ–¥ –≤
–Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–µ–Ω 500. –ò –Ω–∞–ø–æ—Å–ª–µ–¥–æ–∫ –µ—Å–ª–∏ –º—ã —É–∫–∞–∑–∞–ª–∏ –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –µ–≥–æ –∫–∞–∫
`hidden: false`, —Ç–æ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —Ç–µ–ª–µ.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ, –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ —Å—Ç–æ–∏—Ç –Ω–∞ `ErrorResponse` - —ç—Ç–æ –ø—Ä–æ—Å—Ç–µ–π—à–∞—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ 1 —Å—Ç—Ä–æ–∫–æ–≤–æ–µ
–ø–æ–ª–µ `error`. –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–µ–æ–±—Ö–æ–¥–∏–º —á—Ç–æ–±—ã –≤—ã–∑—ã–≤–∞–ª–∏—Å—å –≥–µ—Ç—Ç–µ—Ä—ã —É —ç—Ç–æ–π –º–æ–¥–µ–ª–∏ –∏–Ω–∞—á–µ –Ω–∞–º –±—ã –ø—Ä–∏—à–ª–æ—Å—å –æ–±—ä—è–≤–∏—Ç—å —ç—Ç–æ –ø–æ–ª–µ
`error` –∫–∞–∫ `public`.

–≠—Ç–æ–º—É `EventListener`'—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —á—Ç–æ–±—ã –æ–Ω –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Ä–∞–Ω—å—à–µ, —á–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ:

```yaml
App\EventListener\ApiExceptionListener:
    tags:
        - { name: kernel.event_listener, event: kernel.exception, priority: 10 }
```

–¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ –∫—É—Ä–ª–∞–Ω—É—Ç—å –∏ –ø–æ–ª—É—á–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ 404 –æ—à–∏–±–∫–∏ –≤ json. –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –º—ã –Ω–µ –±—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å
–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `Accept` –∑–∞–≥–æ–ª–æ–≤–∫–∞.

–ö–∞–∑–∞–ª–æ—Å—å –±—ã —Ç—É—Ç –º–æ–∂–Ω–æ –∑–∞–∫–æ–Ω—á–∏—Ç—å, –Ω–æ –µ—Å—Ç—å –µ—â–µ –ø–∞—Ä–∞ –Ω–µ –ø–æ–∫—Ä—ã—Ç—ã—Ö –Ω–∞–º–∏ –∫–µ–π—Å–æ–≤.

## –ò—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∞–¥–º–∏–Ω–∫–∏

–ß–∞—Å—Ç–æ –±—ã–≤–∞–µ—Ç, —á—Ç–æ –ø–æ–º–∏–º–æ API –≤ —ç—Ç–æ–º –∂–µ –ø—Ä–æ–µ–∫—Ç–µ —É –Ω–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–Ω—è—Ç–∞ –∞–¥–º–∏–Ω–∫–∞ —Ç–∏–ø–∞ Sonata –∏–ª–∏ EasyAdmin, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç
—Å–≤–æ–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ –≤—ã–≤–æ–¥—è—Ç –∫—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ html. –ö–∞–∫ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –Ω–∞—à –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —á–∞—Å—Ç–∏
API?

–ß—Ç–æ–±—ã —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ 1 `EventListener`, –Ω–æ —É–∂–µ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å. –û–Ω –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞
—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –∫ –ø—Ä–∏–º–µ—Ä—É, –ø—É—Ç–∏ `/api/` –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —ç—Ç–æ –≤ –∞—Ç—Ä–∏–±—É—Ç—ã –∑–∞–ø—Ä–æ—Å–∞:

```php
<?php

class ZoneMatcherListener
{
    private RequestMatcherInterface $requestMatcher;

    public function __invoke(RequestEvent $event): void
    {
        $request = $event->getRequest();
        $matched = $this->requestMatcher->matches($request);

        $request->attributes->set(RequestAttributes::API_ZONE, $matched);
    }
}
```

`RequestAttributes::API_ZONE` - –≤—Å–µ–≥–æ –ª–∏—à—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∫–ª—é—á–µ–º –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö.

–¢–∞–∫ –∂–µ –Ω—É–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –¥–æ–±–∞–≤–∏–≤ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —ç—Ç–æ—Ç –∞—Ç—Ä–∏–±—É—Ç:

```php
$isApiZone = $event->getRequest()->attributes->get(RequestAttributes::API_ZONE, true);
if (!$isApiZone) {
    return;
}
```

–ò —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à—Ç—Ä–∏—Ö - –ø–µ—Ä–µ–¥–∞—Ç—å `RequestMatcher` —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```yaml
api_zone_matcher:
    class: Symfony\Component\HttpFoundation\RequestMatcher
    arguments: ['^/api/']

App\EventListener\ZoneMatcherListener:
    tags:
        - { name: kernel.event_listener, event: kernel.request, priority: 300 }
    arguments:
        - '@api_zone_matcher'
```

## –í –∑–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –≤—Å–µ–≥–æ —ç—Ç–æ–≥–æ —É –Ω–∞—Å –ø–æ—è–≤–∏–ª—Å—è –≤–ø–æ–ª–Ω–µ –≤–∏–¥–∏–º—ã–π –ø—Ä–æ—Ñ–∏—Ç - –Ω–∞—à–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ –∏ –≥–∏–±–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—é—Ç—Å—è –≤
http-–æ—Ç–≤–µ—Ç—ã –≤ 1 –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –º–µ—Å—Ç–µ. –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ `try-catch` —á—Ç–æ–±—ã –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

–†–∞–Ω–µ–µ —è —Å–∫–∞–∑–∞–ª –ø—Ä–æ *–ø–∞—Ä—É –∫–µ–π—Å–æ–≤* –∏ –Ω–µ –ø—Ä–∏–≤–µ–ª –≤—Ç–æ—Ä–æ–π. –≠—Ç–æ—Ç –∫–µ–π—Å - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –ú—ã
–Ω–µ –±—É–¥–µ–º –µ–≥–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è, –Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–µ—Ä–Ω–µ–º—Å—è –∫ –Ω–µ–º—É –∫–æ–≥–¥–∞ –±—É–¥–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–∫–∞–∑–µ.

–í–µ—Å—å –∫–æ–¥ —Å —Ç–µ—Å—Ç–∞–º–∏ –∑–∞–ª—å—é –Ω–∞ –¥–Ω—è—Ö.